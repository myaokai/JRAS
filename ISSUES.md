# UI確認で見つかった課題一覧

Playwright CLIによるUI検証で発見した課題です。

---

## Issue #1: bug: 章アイテムのlabelクリックで二重トグルが発生

**優先度:** 高

### 概要

章選択UIで、章アイテムの`<label>`部分をクリックすると、チェックボックスの状態が変わらない。

### 再現手順

1. スタート画面を表示
2. 章アイテムのラベルテキスト部分をクリック
3. チェックボックスの状態が変わらないことを確認

### 原因

`app.js:188-194` のクリックハンドラで、`<label for="chapter-X">`のデフォルト動作によるcheckboxトグルと、JSイベントハンドラによるトグルが二重に実行されるため、結果的に状態が元に戻る。

```javascript
// 現在のコード（app.js:188-194）
div.addEventListener('click', (e) => {
    if (e.target.tagName !== 'INPUT') {
        checkbox.checked = !checkbox.checked;  // ← labelのデフォルト動作と二重トグル
        toggleChapter(chapterId, checkbox.checked);
        div.classList.toggle('selected', checkbox.checked);
    }
});
```

### 期待動作

章アイテムのどの部分をクリックしても、選択/解除が正しく1回だけ切り替わる。

### 修正案

`e.target.tagName !== 'LABEL'` の条件を追加するか、`<label>`の`for`属性を削除してJS側で一元管理する。

---

## Issue #2: bug: 空の重複プレースホルダー問題が3件存在

**優先度:** 高

### 概要

`questions.js` の末尾に、`id: 11` が重複し `text: ""` の空エントリが3件存在する。これらが出題対象に含まれてしまう。

### 該当箇所

`questions.js:181-198`

```javascript
{
    id: 11,
    chapter: 1,
    section: 4,
    text: ""
},
// 同じものが3つ
```

### 影響

- 全15問中3問が空の問題として出題される可能性がある
- 出題されると穴埋め0個の空白画面が表示される
- `id: 11` の重複により、進捗追跡（`completedQuestions` Set）で正規のid:11の問題と区別できない
- 総問題数が「15問」と表示されるが、有効な問題は12問のみ

### 修正案

該当の3エントリを削除する。

---

## Issue #3: fix: 穴埋め要素のキーボードアクセシビリティ未対応

**優先度:** 高

### 概要

穴埋め部分は `<span class="blank">` で生成されており、キーボード操作やスクリーンリーダーでの利用ができない。

### 該当箇所

- `app.js:292-297` (`parseQuestionText` 関数)
- `app.js:308-313` (`setupBlankEvents` 関数)
- `style.css:283-316`

### 現状

| 属性 | 値 |
|------|-----|
| `role` | なし |
| `aria-label` | なし |
| `tabindex` | なし |
| キーボードフォーカス | 不可 |
| Enter/Spaceキー操作 | 不可 |

Playwright検証結果:
```
穴埋めフォーカス可能: false
Tab後フォーカス: tag=BUTTON, id=showAllBtn（穴埋めをスキップしてボタンへ移動）
```

### 影響

- キーボードのみのユーザーがクイズに回答できない
- スクリーンリーダー利用者に穴埋め部分の存在が伝わらない

### 修正案

1. `parseQuestionText()` で生成する `<span>` に `tabindex="0"`, `role="button"`, `aria-label="穴埋め（クリックで表示）"` を追加
2. `setupBlankEvents()` でキーボードイベント（Enter/Space）のハンドリングを追加
3. revealed状態のaria-label更新（例: `aria-label="回答: ○○"`）

---

## Issue #4: fix: モバイルで問題ヘッダーが折り返さない

**優先度:** 中

### 概要

モバイル表示（375px）でクイズ画面の問題ヘッダー（問題番号＋カテゴリ）が横並びのまま折り返さず、カテゴリテキストが窮屈になる。

### 該当箇所

`style.css:257-263`

```css
.question-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid #eee;
}
```

### 検証結果

```
モバイル問題ヘッダー: {"w":315,"h":56,"wrap":"nowrap"}
```

`flex-wrap` が未設定のため `nowrap` のまま。カテゴリ名が長い場合（例:「総論 第１章 不動産の鑑定評価に関する基本的考察 / 第２節 不動産とその価格の特徴」）、テキストが狭い幅に押し込まれる。

### 修正案

モバイル用のメディアクエリ（`@media (max-width: 600px)`）内で以下を追加:

```css
.question-header {
    flex-wrap: wrap;
    gap: 5px;
}

#questionCategory {
    width: 100%;
    text-align: left;
}
```

---

## Issue #5: add: 第2章以降の問題データを追加

**優先度:** 中

### 概要

`chapters` マスターには12章分の定義があるが、実際の問題データは第1章のみ（有効12問）。章選択UIに1章しか表示されず、選択機能が実質的に機能していない。

### 現状

| 章 | タイトル | 問題数 |
|----|---------|--------|
| 1 | 総論 第１章 不動産の鑑定評価に関する基本的考察 | 12問（有効） |
| 2〜12 | （定義あり） | 0問 |

`generateChapterList()` で問題数0の章は非表示になるため、UIには1章のみ表示される。

### 影響

- 章選択・全選択/全解除などのUI機能が実質的に無意味
- 学習範囲が第1章に限定され、試験対策としての網羅性が不足

### 対応

各章の不動産鑑定評価基準のテキストから穴埋め問題を作成し、`questions.js` に追加する。

---

## Issue #6: update: 結果画面の情報を充実させる

**優先度:** 中

### 概要

結果画面が「学習完了！」と1行のテキスト、「もう一度」ボタンのみで非常に簡素。学習の振り返りやモチベーション向上に繋がる情報がない。

### 現状

```
学習完了!
全10問を学習しました。累計 9 / 15 問完了です。
[もう一度]
```

### 改善案

以下の要素を追加することで、学習体験を向上させる:

1. **プログレスバー**: 全体の進捗を視覚的に表示
2. **章別進捗**: 各章ごとの完了率を表示
3. **今回のセッション情報**: 今回新しく完了した問題数
4. **達成メッセージ**: 進捗率に応じた励ましメッセージ（例: 50%超えで「半分以上完了！」、100%で「全問制覇！」）

---

## Issue #7: update: 未回答での次の問題への遷移を制御

**優先度:** 低

### 概要

「次の問題」ボタンが穴埋めの回答状況に関わらず常に有効で、未回答のまま先に進める。

### 現状

クイズ画面で穴埋めを1つもクリックしなくても「次の問題」ボタンで次に進めてしまう。学習効果を最大化するためには、全穴埋めを確認してから次へ進むことが望ましい。

### 改善案

- 「次の問題」ボタンを初期状態で `disabled` にする
- 全穴埋めが `revealed` になった時点で有効化する
- または、未回答がある状態で「次の問題」を押した場合に確認ダイアログを表示する

---

## Issue #8: update: 出題数の動的表示

**優先度:** 低

### 概要

スタート画面に「選択した章からランダムに **10問** 出題されます」と固定表示されているが、選択した章の問題数が10未満の場合、実際の出題数は問題数に制限される。

### 現状

例えば第1章のみ（有効12問）を選択した場合は10問出題されるが、将来的に問題数の少ない章のみを選択した場合、表示と実際の出題数にズレが生じる。

### 改善案

- 選択中の章の合計問題数をリアルタイムで計算
- `Math.min(合計問題数, 10)` で実際の出題数を表示
- 例: 「選択した章からランダムに **8問**（全8問中）出題されます」
